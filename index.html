<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Học từ vựng với Flashcards</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #121212;
            color: #ffffff;
        }

        .flashcard {
            width: 400px;
            height: 250px;
            border: 1px solid #444;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
            perspective: 1000px;
            background-color: #1e1e1e;
            position: relative;
            transition: transform 0.6s;
            margin-top: 20px;
        }

        .flashcard>div {
            width: 100%;
            height: 100%;
            position: absolute;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-size: 24px;
            padding: 20px;
            box-sizing: border-box;
            white-space: pre-line;
        }

        .front {
            background-color: #1e1e1e;
            color: #ffffff;
        }

        .back {
            background-color: #333;
            color: #ffffff;
            transform: rotateY(180deg);
        }

        .flashcard.flipped .front {
            transform: rotateY(180deg);
        }

        .flashcard.flipped .back {
            transform: rotateY(0deg);
        }

        .buttons {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: #fff;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 16px;
        }

        button:hover {
            background-color: #0056b3;
        }

        select {
            margin-bottom: 20px;
            padding: 10px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #444;
            background-color: #1e1e1e;
            color: #ffffff;
        }
    </style>
</head>

<body>
    <select id="lessonSelect" onchange="filterByLesson()">
        <option value="all">All</option>
    </select>
    <div id="flashcardContainer">
        <div class="flashcard" id="flashcard" onclick="flipFlashcard()">
            <div id="front" class="front"></div>
            <div id="back" class="back"></div>
        </div>
    </div>
    <div class="buttons">
        <button onclick="prevFlashcard()">Prev</button>
        <button onclick="nextFlashcard()">Next</button>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script>
        let flashcards = [];
        let filteredFlashcards = [];
        let currentIndex = 0;

        // Tự động tải file Excel từ cùng thư mục
        const filePath = "vocabularyN5_v2.xlsx";

        function loadExcel() {
            fetch(filePath)
                .then(response => response.arrayBuffer())
                .then(data => {
                    const workbook = XLSX.read(new Uint8Array(data), { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    flashcards = parseData(jsonData);
                    populateLessons();
                    filterByLesson();
                })
                .catch(err => console.error("Không thể đọc file Excel:", err));
        }

        function parseData(jsonData) {
            let cards = [];
            let currentLesson = '';
            jsonData.forEach(row => {
                if (row[0] && row[0].includes('Bài')) {
                    currentLesson = row[0];
                } else {
                    cards.push({
                        lesson: currentLesson,
                        front: `${row[0] || ''}\n${row[1] || ''}`,
                        back: `${row[3] || ''}\n${row[2] || ''}\n${row[4] || ''}`
                    });
                }
            });
            return cards;
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function populateLessons() {
            const lessonSelect = document.getElementById('lessonSelect');
            const lessons = [...new Set(flashcards.map(f => f.lesson))].filter(lesson => lesson);
            lessons.forEach(lesson => {
                const option = document.createElement('option');
                option.value = lesson;
                option.innerText = lesson;
                lessonSelect.appendChild(option);
            });
        }

        function filterByLesson() {
            const lessonSelect = document.getElementById('lessonSelect');
            const selectedLesson = lessonSelect.value;
            filteredFlashcards = selectedLesson === 'all' ? flashcards : flashcards.filter(f => f.lesson === selectedLesson);
            shuffleArray(filteredFlashcards);
            currentIndex = 0;
            displayFlashcard();
        }

        function displayFlashcard() {
            const flashcard = document.getElementById('flashcard');
            if (filteredFlashcards.length > 0) {
                flashcard.classList.remove('flipped');
                document.getElementById('front').innerText = filteredFlashcards[currentIndex].front;
                document.getElementById('back').innerText = filteredFlashcards[currentIndex].back;
            } else {
                document.getElementById('front').innerText = 'Không có từ vựng';
                document.getElementById('back').innerText = '';
            }
        }

        function flipFlashcard() {
            const flashcard = document.getElementById('flashcard');
            flashcard.classList.toggle('flipped');
        }

        function prevFlashcard() {
            if (currentIndex > 0) {
                currentIndex--;
                displayFlashcard();
            }
        }

        function nextFlashcard() {
            if (currentIndex < filteredFlashcards.length - 1) {
                currentIndex++;
                displayFlashcard();
            }
        }

        document.addEventListener('keydown', (event) => {
            if (event.key === 's') {
                flipFlashcard();
            } else if (event.key === 'a') {
                prevFlashcard();
            } else if (event.key === 'd') {
                nextFlashcard();
            }
        });

        // Tự động tải file Excel khi trang được tải
        loadExcel();
    </script>
</body>

</html>